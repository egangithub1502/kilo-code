apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: stratex
  namespace: profit
  labels:
    app: stratex
    enabled: "true"
spec:
  replicas: 2
  strategy:
    blueGreen:
      activeService: stratex-svc
      previewService: stratex-preview-svc
      autoPromotionEnabled: false
  selector:
    matchLabels:
      app: stratex
  template:
    metadata:
      labels:
        app: stratex
        enabled: "true"
    spec:
      containers:
        - name: stratex
          image: python:3.9-slim
          imagePullPolicy: Always
          command: ["python", "-m", "http.server", "8000"]
          ports:
            - containerPort: 8000
              protocol: TCP
          resources:
            requests:
              cpu: "100m"
              memory: "512Mi"
            limits:
              cpu: "500m"
              memory: "1Gi"
          securityContext:
            seccompProfile:
              type: RuntimeDefault
            capabilities:
              drop: ["ALL"]
            allowPrivilegeEscalation: false
            runAsNonRoot: true
            runAsUser: 1000
          readinessProbe:
            httpGet:
              path: /
              port: 8000
            initialDelaySeconds: 5
            periodSeconds: 5
          livenessProbe:
            httpGet:
              path: /
              port: 8000
            initialDelaySeconds: 5
            periodSeconds: 5
      nodeSelector:
        cloud.google.com/gke-nodepool: jegan-test-cluster-pool

